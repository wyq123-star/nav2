name: driver
x-common:
  # 定义别名，用于引用
  &common
  environment:
    - DISPLAY=${DISPLAY}
    - NVIDIA_VISIBLE_DEVICES=all
    - NVIDIA_DRIVER_CAPABILITIES=all
    - OMP_WAIT_POLICY=passive
    - TERM=xterm-256color
    - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp # 使用CycloneDDS就取消注释此行
    - ROS_LOCALHOST_ONLY=1
  volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
  tty: true
  network_mode: host
  pid: "host" # 添加 pid 命名空间共享
  ipc: "host" # 添加 ipc 命名空间共享
  privileged: true
  user: "yutou"
  stdin_open: true
services:
  nav2-service:
    # build:
    #   context: ..
    #   dockerfile: .devcontainer/Dockerfile
    image: yutouxiaozhuan/nav2-humble:latest
    container_name: nav_container
    <<: *common
    volumes:
      - nav2_volume:/home/yutou/ros2_ws
      - /var/run/docker.sock:/var/run/docker.sock
      - /dev:/dev
    working_dir: "/home/yutou/ros2_ws" # 指定默认工作目录
    # ros-noetic:
    #   <<: *common
    #   image: elainasuki/ros:ros-noetic-full
    #   container_name: ros-noetic-master
    #   entrypoint: [ "/bin/bash", "-c", "source /opt/ros/noetic/setup.bash && roscore" ]
volumes:
  nav2_volume:
    driver: local
    driver_opts:
      type: none # 表示直接绑定本地目录
      device: ./.. # 对应原 ./..（当前 Compose 所在目录的上一级）
      o: bind # 启用绑定模式，保证双向同步
    name: nav_volume
